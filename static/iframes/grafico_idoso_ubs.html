<html>
  <head>
    <meta charset="utf-8" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"
      defer
    ></script>
    <style>
      body {
        background: transparent;
        margin: 0;
        padding: 20px;
        font-family: "Segoe UI", sans-serif;
      }

      .chart-wrapper {
        max-width: 1100px;
        margin: 0 auto;
      }

      .chart-title {
        font-size: 24px;
        font-weight: 800;
        color: #1b2d4a; /* azul profundo similar ao da imagem */
        letter-spacing: 1px; /* leve espaﾃｧamento */
        text-transform: uppercase; /* deixa igual ao da imagem */
        margin-bottom: 14px;
      }

      .chart-subtitle {
        font-size: 14px;

        color: #1b2d4a;
        letter-spacing: 1px;

        margin-top: -6px; /* aproxima do tﾃｭtulo */
        margin-bottom: 16px;
        opacity: 0.85; /* levemente mais suave que o tﾃｭtulo */
      }

      /* BOTﾃ髭S */
      .buttons-container {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .filter-btn {
        padding: 8px 16px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: 0.25s;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .filter-btn[data-filter="todos"] {
        background: linear-gradient(135deg, #16c79a33, #f7c94833);
        color: #4a4a4a;
        border: 2px solid #16c79a55;
      }

      .filter-btn[data-filter="todos"].active {
        background: linear-gradient(135deg, #16c79a, #f7c948);
        color: white;
        border-color: transparent;
      }

      /* Hover sﾃｳ quando Nﾃグ estﾃ｡ ativo */
      .filter-btn[data-filter="todos"]:not(.active):hover {
        filter: brightness(1.15);
      }

      .filter-btn[data-filter="idosos"] {
        background: #16c79a22;
        border: 2px solid #16c79a;
        color: #16c79a;
      }

      .filter-btn[data-filter="idosos"].active {
        background: #16c79a;
        color: white;
        border-color: #16c79a;
      }

      /* Hover sﾃｳ quando Nﾃグ ativo */
      .filter-btn[data-filter="idosos"]:not(.active):hover {
        background: #16c79a44;
        color: #0f6f52;
      }

      .filter-btn[data-filter="ubs"] {
        background: #f7c94822;
        border: 2px solid #f7c948;
        color: #d6a820;
      }

      .filter-btn[data-filter="ubs"].active {
        background: #f7c948;
        color: #5f4b00;
        border-color: #f7c948;
      }

      /* Hover sﾃｳ quando Nﾃグ ativo */
      .filter-btn[data-filter="ubs"]:not(.active):hover {
        background: #f7c94855;
        color: #7b6504;
      }

      /* Remove fundo do Plotly */
      .plot-container,
      .plotly .main-svg {
        background: transparent !important;
      }

      .modebar-container {
        display: none !important;
      }

      /* Tooltip com gradiente */
      .customtooltip {
        background: linear-gradient(135deg, #ffffffdd, #e6ecffdd);
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #15438944;
        font-size: 13px;
        color: #154389;
        box-shadow: 0 4px 12px #0002;
      }
    </style>
  </head>

  <body>
    <div class="chart-wrapper">
      <div class="chart-title">IDOSOS E UBS POR REGIﾃグ - 2022</div>
      <div class="chart-subtitle">
        Fonte: IBGE / Consolidaﾃｧﾃ｣o Municipal (Censo 2022).
      </div>

      <div class="buttons-container">
        <button class="filter-btn active" data-filter="todos">
          <i class="fa-solid fa-layer-group"></i> Todos
        </button>
        <button class="filter-btn" data-filter="idosos">
          <i class="fa-solid fa-person-cane"></i> Idosos
        </button>
        <button class="filter-btn" data-filter="ubs">
          <i class="fa-solid fa-house-medical"></i> UBS
        </button>
      </div>

      <script src="https://cdn.plot.ly/plotly-3.3.0.min.js"></script>

      <div id="chart" style="height: 80%; width: 100%"></div>

      <script>
        const regioes = [
          "Centro",
          "Leste",
          "Norte",
          "Oeste",
          "SFX",
          "Sudeste",
          "Sul",
        ];

        const icones = {
          Centro: "fa-city",
          Leste: "fa-compass",
          Norte: "fa-arrow-up",
          Oeste: "fa-arrow-left",
          SFX: "fa-church",
          Sudeste: "fa-location-dot",
          Sul: "fa-arrow-down",
        };

        const dados = {
          idosos: [15, 22, 18, 10, 12, 8, 9],
          ubs: [5, 13, 6, 8, 9, 4, 7],
        };

        function addIcon(nome) {
          return `<span style='margin-right:6px'><i class="fa-solid ${icones[nome]}"></i></span>${nome}`;
        }

        const traceIdosos = {
          name: "Idosos",
          type: "bar",
          marker: {
            color: "#16C79A",
            line: { color: "white", width: 1 },
            opacity: 0.95,
          },

          x: regioes.map(addIcon),
          y: dados.idosos,

          texttemplate: "%{y}",
          textposition: "outside",

          // 櫨 hovertext separado resolve tudo
          hovertext: dados.idosos.map((v) => `${v}`),

          hovertemplate:
            "<b>%{x}</b><br>" +
            "<span style='color:#ffffff'>其 Idosos: <b>%{hovertext}</b></span><br>" +
            "<extra></extra>",

          hoverlabel: {
            bgcolor: "#16C79A",
            bordercolor: "#0e7a5d",
            font: { color: "white", size: 13 },
          },
        };

        const traceUBS = {
          name: "UBS",
          type: "bar",
          marker: {
            color: "#F7C948",
            line: { color: "white", width: 1 },
          },

          x: regioes.map(addIcon),
          y: dados.ubs,
          texttemplate: "%{y}",
          textposition: "outside",

          hovertemplate:
            "<b>%{x}</b><br>" +
            "<span style='color:#5f4b00'>唱 UBS: <b>%{y}</b></span><br>" +
            "<extra></extra>",

          hoverlabel: {
            bgcolor: "#F7C948",
            bordercolor: "#a78800",
            font: { color: "#5f4b00", size: 13 },
          },
        };

        const layout = {
          paper_bgcolor: "rgba(0,0,0,0)",
          plot_bgcolor: "rgba(0,0,0,0)",

          showlegend: false, // REMOVE AQUELE BLOCO FEIO

          barmode: "group",
          bargap: 0.25,

          xaxis: {
            tickfont: { size: 13, color: "#333" },
          },

          yaxis: {
            tickfont: { size: 13, color: "#333" },
            gridcolor: "#ccc",
          },

          transition: {
            duration: 800,
            easing: "cubic-in-out",
          },
        };

        function renderChart(traces) {
          Plotly.newPlot("chart", traces, layout, {
            displayModeBar: false,
            responsive: true,
          });

          // Reaplica eventos SEMPRE apﾃｳs recriar o grﾃ｡fico
          const chart = document.getElementById("chart");

          chart.on("plotly_hover", function (event) {
            Plotly.restyle("chart", { opacity: 0.5 });
            Plotly.restyle(
              "chart",
              { opacity: 1 },
              event.points[0].curveNumber
            );
          });

          chart.on("plotly_unhover", function () {
            Plotly.restyle("chart", { opacity: 1 });
          });
        }

        /* Render inicial */
        renderChart([traceIdosos, traceUBS]);

        /* Glow ao passar o mouse */
        const chart = document.getElementById("chart");
        chart.on("plotly_hover", function (event) {
          Plotly.restyle("chart", { opacity: 0.5 });
          Plotly.restyle("chart", { opacity: 1 }, event.points[0].curveNumber);
        });

        chart.on("plotly_unhover", function () {
          Plotly.restyle("chart", { opacity: 1 });
        });

        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            // Remover ACTIVE
            document
              .querySelectorAll(".filter-btn")
              .forEach((b) => b.classList.remove("active"));

            btn.classList.add("active");

            const filtro = btn.dataset.filter;
            let novosTraces = [];

            if (filtro === "todos") novosTraces = [traceIdosos, traceUBS];
            if (filtro === "idosos") novosTraces = [traceIdosos];
            if (filtro === "ubs") novosTraces = [traceUBS];

            // ============================
            // ANIMAﾃﾃグ SUAVE AO TROCAR
            // ============================
            Plotly.animate(
              "chart",
              {
                data: novosTraces,
                traces: [0, 1], // mantﾃｩm posiﾃｧﾃｵes
              },
              {
                transition: {
                  duration: 700,
                  easing: "cubic-in-out",
                },
                frame: {
                  duration: 700,
                },
              }
            );

            // tambﾃｩm atualiza o grﾃ｡fico para refletir nﾃｺmero diferente de traces
            Plotly.react("chart", novosTraces, layout);
          });
        });
      </script>
    </div>
  </body>
</html>
