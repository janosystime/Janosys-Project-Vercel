<html>
  <head>
    <meta charset="utf-8" />

    <!-- FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>

  <body>
    <div class="chart-section">
      <!-- Título -->
      <h2 class="chart-title">CRIANÇAS E ESCOLAS INFANTIS POR REGIÃO — 2022</h2>

      <!-- Fonte -->
      <p class="chart-subtitle">
        Fonte: IBGE / Consolidação Municipal (Censo 2022).
      </p>

      <!-- Botões estilo pill -->
      <div class="btns-container">
        <button class="chart-btn ativo btn-criancas" data-key="criancas">
          <i class="fa-solid fa-child"></i> Crianças
        </button>

        <button class="chart-btn ativo btn-municipais" data-key="municipais">
          <i class="fa-solid fa-school"></i> Municipais
        </button>

        <button
          class="chart-btn ativo btn-particulares"
          data-key="particulares"
        >
          <i class="fa-solid fa-building-columns"></i> Particulares
        </button>
      </div>

      <!-- Gráfico -->
      <div id="chart"></div>
    </div>

    <style>
      /* ====== LAYOUT ====== */

      .chart-section {
        width: 100%;
        margin-top: 20px;
      }

      .chart-title {
        font-family: "Segoe UI", sans-serif;
        font-size: 1.3rem;
        font-weight: 700;
        color: #1d2d50;
        margin-bottom: 4px;
        padding-left: 40px;
      }

      .chart-subtitle {
        font-family: "Segoe UI", sans-serif;
        font-size: 14px;
        color: #4a5a77;
        margin-bottom: 22px;
        padding-left: 40px;
      }

      /* ====== BOTÕES PILL ====== */

      .btns-container {
        display: flex;
        gap: 14px;
        margin-bottom: 18px;
        padding-left: 40px;
      }

      .chart-btn {
        border: none;
        padding: 10px 22px;
        border-radius: 999px;
        cursor: pointer;
        font-size: 15px;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 8px;
        background: #777; /* fallback */
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        transition: background 0.35s ease, color 0.35s ease, opacity 0.25s ease,
          transform 0.25s ease;
      }

      .chart-btn:hover {
        transform: translateY(-3px);
        opacity: 1;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.18);
      }

      .chart-btn.ativo {
        transform: translateY(-2px);
        opacity: 1;
      }

      /* Quando o botão NÃO está ativo → fica cinza */
      .chart-btn:not(.ativo) {
        background: #b9c2cc !important;
        color: #2f3b52 !important;
        opacity: 0.7;
        box-shadow: none;
        transform: none;
      }

      /* CORES QUE VOCÊ JÁ USA */
      .btn-criancas {
        background: #e74c3c;
      }

      .btn-municipais {
        background: #3498db;
      }

      .btn-particulares {
        background: #2ecc71;
      }

      /* ====== GRÁFICO ====== */

      #chart {
        height: 500px !important;
      }

      .plotly-tooltip {
        background: #ffffffee !important;
        backdrop-filter: blur(6px);
        border: 1px solid #d7e0ea !important;
        border-radius: 12px !important;
        padding: 10px 14px !important;

        color: #1d2d50 !important;
        font-family: "Segoe UI", sans-serif;
        font-size: 14px !important;
        line-height: 1.4em !important;

        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.08) !important;

        transform: translateY(-6px);
        transition: opacity 0.18s ease, transform 0.18s ease;
      }

      @media (max-width: 600px) {
        .chart-title {
          font-size: 1.05rem;
          line-height: 1.3em;
        }

        .chart-subtitle {
          font-size: 12px;
          margin-bottom: 14px;
        }

        .btns-container {
          flex-wrap: wrap;
          gap: 10px;
        }

        .chart-btn {
          font-size: 14px;
          padding: 9px 18px;
        }

        #chart {
          height: 380px !important; /* Melhor visual em telas pequenas */
        }

        /* Tooltip um pouco mais compacto */
        .plotly-tooltip {
          font-size: 12px !important;
          padding: 8px 10px !important;
        }
      }
    </style>

    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-3.3.0.min.js"></script>

    <script>
      const chartId = "chart";

      const datasets = {
        criancas: {
          visible: true,
          trace: {
            name: "Crianças 0 a 4 anos",
            offsetgroup: "1",
            text: ["6.18%", "20.81%", "16.28%", "16.97%", "0.04%", "14.98%"],
            textposition: "outside",
            textfont: { color: "#1d2d50", size: 13 },
            marker: { color: "#e74c3c" },
            hovertemplate:
              "<b>%{x}</b> – Crianças(0-4)<br>%{y}%<extra></extra>",
            x: ["Centro", "Leste", "Norte", "Oeste", "Sudeste", "Sul"],
            y: [6.18, 20.81, 16.28, 16.97, 0.04, 14.98],
            type: "bar",
          },
        },

        municipais: {
          visible: true,
          trace: {
            name: "Escolas Municipais",
            offsetgroup: "2",
            text: ["3.57%", "6.70%", "4.91%", "1.34%", "2.68%", "9.82%"],
            textposition: "outside",
            textfont: { color: "#1d2d50", size: 13 },
            marker: { color: "#3498db" },
            hovertemplate:
              "<b>%{x}</b> – Escolas Municipais<br>%{y}%<extra></extra>",
            x: ["Centro", "Leste", "Norte", "Oeste", "Sudeste", "Sul"],
            y: [3.57, 6.7, 4.91, 1.34, 2.68, 9.82],
            type: "bar",
          },
        },

        particulares: {
          visible: true,
          trace: {
            name: "Escolas Particulares",
            offsetgroup: "3",
            text: ["16.52%", "12.95%", "3.12%", "10.27%", "3.57%", "24.55%"],
            textposition: "outside",
            textfont: { color: "#1d2d50", size: 13 },
            marker: { color: "#2ecc71" },
            hovertemplate:
              "<b>%{x}</b> – Escolas Particulares<br>%{y}%<extra></extra>",
            x: ["Centro", "Leste", "Norte", "Oeste", "Sudeste", "Sul"],
            y: [16.52, 12.95, 3.12, 10.27, 3.57, 24.55],
            type: "bar",
          },
        },
      };

      function renderChart() {
        const traces = Object.entries(datasets)
          .filter(([k, d]) => d.visible)
          .sort(([a], [b]) => {
            const ordem = { criancas: 1, municipais: 2, particulares: 3 };
            return ordem[a] - ordem[b];
          })
          .map(([_, d]) => JSON.parse(JSON.stringify(d.trace)));

        Plotly.react(
          chartId,
          traces,
          {
            barmode: "group",
            font: { family: "Segoe UI", size: 13, color: "#1d2d50" },
            plot_bgcolor: "rgba(0,0,0,0)",
            paper_bgcolor: "rgba(0,0,0,0)",
            yaxis: { gridcolor: "#dce6f3", zeroline: false },
            xaxis: { gridcolor: "transparent" },
            margin: { t: 20, b: 70, l: 50, r: 10 },
            transition: { duration: 350 },
            showlegend: false,
          },
          {
            displayModeBar: false,
          }
        );
      }

      renderChart();

      document.querySelectorAll(".chart-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          const key = e.currentTarget.dataset.key;
          datasets[key].visible = !datasets[key].visible;
          e.currentTarget.classList.toggle("ativo");
          renderChart();
        });
      });
    </script>
  </body>
</html>
